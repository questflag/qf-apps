@page "/login"
@using QuestFlag.Passport.UserClient
@inject PassportUserClient PassportClient
@inject NavigationManager Nav
@inject IJSRuntime JS

<PageTitle>Sign In — @(_resolvedTenant?.Name ?? "QuestFlag")</PageTitle>

<div class="sso-container">
    <div class="sso-card">
        <!-- Brand / Tenant Header -->
        <div class="sso-header">
            <div class="brand-logo">QF</div>
            @if (_resolvedTenant != null)
            {
                <h1 class="tenant-name">@_resolvedTenant.Name</h1>
                <p class="sign-in-subtitle">Sign in to your account</p>
            }
            else
            {
                <h1 class="tenant-name">QuestFlag</h1>
                <p class="sign-in-subtitle">Sign in to continue</p>
            }
        </div>

        @if (_error != null)
        {
            <div class="error-banner">@_error</div>
        }

        <form @onsubmit="HandleLogin">
            <!-- Tenant selector (only shown when not auto-resolved from domain) -->
            @if (_resolvedTenant == null)
            {
                <div class="form-group">
                    <label>Organization</label>
                    <select @bind="_tenantSlug" disabled="@(_loadingTenants || _tenants == null)">
                        <option value="">— Select your organization —</option>
                        @foreach (var t in _tenants ?? [])
                        {
                            <option value="@t.Slug">@t.Name</option>
                        }
                    </select>
                </div>
            }

            <div class="form-group">
                <label>Username</label>
                <input @bind="_username" type="text" placeholder="username" autocomplete="username" required />
            </div>

            <div class="form-group">
                <label>Password</label>
                <input @bind="_password" type="password" placeholder="••••••••" autocomplete="current-password" required />
            </div>

            <button type="submit" class="btn-primary" disabled="@_isSubmitting">
                @(_isSubmitting ? "Signing in…" : "Continue")
            </button>
        </form>

        <div class="sso-footer">
            <a href="/forgot-password">Forgot password?</a>
        </div>
    </div>
</div>

